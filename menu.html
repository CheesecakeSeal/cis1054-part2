<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Menu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <h1>Our Menu</h1>

    <h2>Food</h2>
    <div id="food-list"></div>

    <h2>Drinks</h2>
    <div id="drinks-list"></div>

    <nav>
        <a href="index.html">Home</a> |
        <a href="favourites.html">Favourites</a>
    </nav>

    <script>
        function loadCSV(file, targetId) {
            fetch(file)
                .then(response => response.text())
                .then(csv => {
                    Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function (results) {
                            const target = document.getElementById(targetId);
                            const data = results.data;

                            // Clear the target container before appending
                            target.innerHTML = '';

                            // Group by category
                            const grouped = {};
                            data.forEach(item => {
                                const category = item.category?.trim() || "Other";
                                if (!grouped[category]) grouped[category] = [];
                                grouped[category].push(item);
                            });

                            // Sort categories
                            for (const [category, items] of Object.entries(grouped)) {
                                const heading = document.createElement("h3");
                                heading.textContent = category;
                                target.appendChild(heading);

                                const ul = document.createElement("ul");
                                items.forEach(item => {
                                    const li = document.createElement("li");
                                    li.innerHTML = `
                                        <a href="dish.html?id=${encodeURIComponent(item.id)}">${item.name}</a><br/>
                                        <small>${item.description}</small>
                                    `;
                                    ul.appendChild(li);
                                });

                                target.appendChild(ul);
                            }
                        },
                        error: function(err) {
                            console.error("Error parsing CSV:", err);
                            const target = document.getElementById(targetId);
                            target.textContent = "Failed to load menu.";
                        }
                    });
                })
                .catch(error => {
                    console.error("Error fetching CSV:", error);
                    const target = document.getElementById(targetId);
                    target.textContent = "Failed to load menu.";
                });
        }

        loadCSV("food_menu.csv", "food-list");
        loadCSV("drinks_menu.csv", "drinks-list");
    </script>
</body>
</html>
