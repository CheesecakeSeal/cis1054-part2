<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Menu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <h1>Our Menu</h1>

    <h2>Food</h2>
    <div id="food-list"></div>

    <h2>Drinks</h2>
    <div id="drinks-list"></div>

    <nav>
        <a href="index.html">Home</a> |
        <a href="favourites.html">Favourites</a>
    </nav>

    <script>
        class MenuLoader {
            constructor() {}

            load(file, targetId, type) {
                fetch(file)
                    .then(response => response.text())
                    .then(csv => {
                        Papa.parse(csv, {
                            header: true,
                            skipEmptyLines: true,
                            complete: (results) => {
                                this.displayItems(results.data, targetId, type);
                            },
                            error: (err) => {
                                console.error("Error parsing CSV:", err);
                                document.getElementById(targetId).textContent = "Failed to load menu.";
                            }
                        });
                    })
                    .catch(error => {
                        console.error("Error fetching CSV:", error);
                        document.getElementById(targetId).textContent = "Failed to load menu.";
                    });
            }

            displayItems(data, targetId, type) {
                const target = document.getElementById(targetId);
                target.innerHTML = '';

                const grouped = {};
                data.forEach(item => {
                    const category = (item.category || "Other").trim();
                    if (!grouped[category]) grouped[category] = [];
                    grouped[category].push(item);
                });

                for (const [category, items] of Object.entries(grouped)) {
                    const heading = document.createElement("h3");
                    heading.textContent = category;
                    target.appendChild(heading);

                    const ul = document.createElement("ul");
                    items.forEach(item => {
                        const id = encodeURIComponent(item.id);
                        ul.insertAdjacentHTML('beforeend', `
                            <li>
                                <a href="dish.html?id=${id}&type=${type}">
                                    ${item.name}
                                </a><br/>
                                <small>${item.description}</small>
                            </li>
                        `);
                    });

                    target.appendChild(ul);
                }
            }
        }

        const menuLoader = new MenuLoader();
        menuLoader.load("food_menu.csv", "food-list", "food");
        menuLoader.load("drinks_menu.csv", "drinks-list", "drink");
    </script>
</body>
</html>
